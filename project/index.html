<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" type="text/css" href="../CSS/bootstrap.min.css" />
    <script src="../JS/jquery.min.js"></script>
    <script src="../JS/bootstrap.min.js"></script>
    <title>My Notes</title>
    <style>
        
        body
        {
            background-image: url("library.jpg");
            background-size: cover;
        }

        #header
        {
            background-color: rgba(228, 168, 85, 0.6);
            background-clip: border-box;
            margin: 0 0 10px;
            padding: 20px 0 2px;
            border-bottom: 1px;
        }

        #notestable
        {
            background-color: rgba(219, 130, 229, 0.60);
            color: black;
        }

        tr:hover
        {
            cursor: pointer;
        }

        #firstrow:hover
        {
            cursor: default;
        }

        #onenotediv
        {
            display: none;
            position: absolute;
            top: 60px;
            left: 50px;
            background-color: azure;
            border-style: solid;
            border-color: green;
            border-width: 1px;
        }

        #notetitlediv
        {
            border-style: solid;
            border-color: black;
            border-width: 0 0 1px;
        }

        #notedescrdiv
        {
            border-style: solid;
            border-color: rgba(0,0,0,0.5);
            border-width: 1px;
            padding-left: 5px;
        }

        #notetitleform
        {
            max-width: 700px;
        }

        #notedescrform
        {
            max-width: 700px;
        }

        #quotenote
        {
            background-color: rgba(137, 246, 239, 0.60);
        }

    </style>
</head>
<body>
    
    <div id="header">
        <h1 style="display: inline;">Notes to Self</h1>
        <button type="button" class="btn btn-info pull-right" id="addbtn" onclick="addnote();">Add a new note</button>
    </div> 

    
    <br />
    <div class="container" id="notestable">   
        <table class="table table-hover" id="allnotes">
            <caption style="color: black;">
                <h3 style="display: inline;">My Notes</h3>
                <button type="button" class="btn btn-info pull-right" id="sortbtn" onclick="sortNotesNew()">Sort newest to oldest</button>
            </caption>    
            <tr id="firstrow">
                    <th>Sl no</th>
                    <th>Title</th>
                    <th>Last modified</th>
                </tr>
        </table>
     </div>


    <div class="container" id="onenotediv">
        <div style="display: none;" id="notetimediv"></div>
        <div id="notetitlediv">

        </div>
        <br />
        <div id="notedescrdiv">

        </div>
        <br />
        <div class="row" id="onenotedivbtns">
            <div class="col-xs-4">
                <button type="button" class="btn btn-success" onclick="hideNote();">OK</button>
            </div>
            <div class="col-xs-4">
                <button type="button" class="btn btn-info" onclick="editNote();">Edit note</button>
            </div>
            <div class="col-xs-4">
               <button type="button" class="btn btn-warning" onclick="deleteNote();">Delete note</button>
            </div>
        </div>
        <br />

        <div class="container" id="noteeditform" style="display:none;">

        </div>

        <div class="footer" style="display: none;" id="deletealert">
            <p style="display: inline;" class="text-danger">Delete this note permanently?</p>
            &nbsp; &nbsp; &nbsp;
            <button type="button" class="btn btn-danger" id="del-yes">Yes</button>
            &nbsp; &nbsp;
            <button type="button" class="btn btn-info" id="del-no">No</button>
        </div>
        <br />
    </div>

    <br />
    <div class="container" id="quotenote">
        <div class="footer">
            <blockquote>
                <p style="font-style: italic;">
                    "I sometimes find, and I am sure you know the feeling, that I simply have too many thoughts and memories crammed into my mind."
                </p>
                <footer style="color: black;">Albus Dumbledore in J.K. Rowling's Harry Potter series</footer>
            </blockquote>
            <div class="container">
                It is then that I add a new note to remind myself! <br />
                <p class="bg-warning" style="font-size: 17px;"><b>(Wait a few seconds, and if notes still can't be seen, reload the page)</b></p><br />
            </div>
        </div>
    </div>

    <script>

        var authobj = {
            email: "pdevdec@gmail.com",
            rollNo: "16EE30022"
        };

        var sessId;

        $.post("http://www.eduspectrum.com/api/authenticate.php", authobj, function (data) {
            data = JSON.parse(data);
            sessId = data.sessionId;
            console.log("sessionId is " + sessId);
        });

        function addnote()
        {
            window.location.href = "./add.html";
        }

        //Get all notes
        var notesHtml = document.getElementById("allnotes");
        var allPosts;
        setTimeout(getNotes, 960);
        function getNotes()
        {
            var obj = {
                sessionId: sessId,
                rollNo: '16EE30022'
            };
            $.post("http://www.eduspectrum.com/api/getAll.php", obj, function (data) {
                var posts = JSON.parse(data);
                allPosts = posts;
                for (var i = 0; i < posts.length; i++) {
                    console.log(posts[i].title);
                    console.log(posts[i].description);
                    console.log(posts[i].createdAt);
                }
            });
            setTimeout(showAllNotes,1300);
        }

        function showAllNotes()
        {
            var i,date;
            for(i=0;i<allPosts.length;i++)
            {
                date = new Date(allPosts[i].createdAt*1000);
                notesHtml.innerHTML += `<tr id="sl${i}" onclick="showNote(${i});">
                    <td>${i+1}</td>
                <td>${allPosts[i].title}</td>
                <td>${date}</td>
                </tr>`;
            }
        }

        function hideNote()
        {
            $("#deletealert").hide(300);
            $("#noteeditform").hide(300);
            $("#onenotedivbtns").show(300);
            $("#onenotediv").hide(500);
            
        }
 
        function showNote(i)
        {
            document.getElementById("notetitlediv").innerHTML = `<h3 id="notetitleh3">${allPosts[i].title}</h3>`;
            document.getElementById("notedescrdiv").innerHTML = `<p id="notedescrpara" style="font-size: 15px;">${allPosts[i].description}</p>`;         
            document.getElementById("notetimediv").innerHTML = allPosts[i].createdAt;
            $("#onenotediv").show(500);
        }

        function deleteNote()
        {
            $("#deletealert").show(300);

            $("#del-yes").click(function(){
                var post={
                    sessionId: sessId,
                    rollNo: '16EE30022',
                    createdAt: document.getElementById("notetimediv").innerHTML
                };
                $.post( "http://www.eduspectrum.com/api/delete.php", post, function(data) {
                    console.log(data);
                });
                window.location.href="./index.html";
            });

            $("#del-no").click(function(){
                $("#deletealert").hide(300);
            })
        }

        function editNote()
        {
            document.getElementById("noteeditform").innerHTML = `
                <form>
                <div class="form-group">
                <label for="notetitleform"><b>Title</b></label>
                <input type="text" class="form-control" id="notetitleform" value="${document.getElementById('notetitleh3').innerHTML}">
                    </div>
                    <div class="form-group">
                    <label for="notedescrform"><b>Description</b></label>
                    <textarea class="form-control" id="notedescrform" >${document.getElementById('notedescrpara').innerHTML}</textarea>
                    </div>
                    <br>
                    <div class="container">
                    <button type="button" class="btn btn-info" onclick="sendEditedNote();">Save changes</button>
                    &nbsp;
                    <button type="button" class="btn btn-warning" onclick="hideNote();">Cancel</button>
                    </div>
                    <br>
                    </form>
                    <br>
                    <p id="editalert" style="display:none;">Changes have been saved. Reloading main page...</p>
                    <br>`;
            
            $("#onenotedivbtns").hide(300);
            $("#noteeditform").show(300);
        }

            function sendEditedNote()
            {
                var editedNote={
                    sessionId: sessId,
                    rollNo: '16EE30022',
                    title: document.getElementById("notetitleform").value,
                    description: document.getElementById("notedescrform").value
                };
                $.post("http://www.eduspectrum.com/api/create.php", editedNote, function (data) {
                    var postData = JSON.parse(data);
                    console.log(postData);
                });

                var oldNote={
                    sessionId: sessId,
                    rollNo: '16EE30022',
                    createdAt: document.getElementById("notetimediv").innerHTML
                };
                $.post( "http://www.eduspectrum.com/api/delete.php", oldNote, function(data) {
                    console.log(data);
                });

                $("#editalert").show(100);
                setTimeout(function(){
                    window.location.href="./index.html";
                },2000);
            }

            function sortNotesNew()
            {
                var i,date;
                
                if(document.getElementById("sortbtn").innerHTML=='Sort newest to oldest')
                {
                    notesHtml.innerHTML = `<caption style="color: black;">
                <h3 style="display: inline;">My Notes</h3>
                <button type="button" class="btn btn-info pull-right" id="sortbtn" onclick="sortNotesNew()">Sort oldest to newest</button>
            </caption>    
            <tr id="firstrow">
                    <th>Sl no</th>
                    <th>Title</th>
                    <th>Last modified</th>
                </tr>`;
                    for(i=allPosts.length-1;i>=0;i--)
                    {
                        date = new Date(allPosts[i].createdAt*1000);
                        notesHtml.innerHTML += `<tr id="sl${i}" onclick="showNote(${i});">
                    <td>${i+1}</td>
                <td>${allPosts[i].title}</td>
                <td>${date}</td>
                </tr>`;
                    }
                }

                else
                {
                    notesHtml.innerHTML = `<caption style="color: black;">
                <h3 style="display: inline;">My Notes</h3>
                <button type="button" class="btn btn-info pull-right" id="sortbtn" onclick="sortNotesNew()">Sort newest to oldest</button>
            </caption>    
            <tr id="firstrow">
                    <th>Sl no</th>
                    <th>Title</th>
                    <th>Last modified</th>
                </tr>`;
                    for(i=0;i<allPosts.length;i++)
                    {
                        date = new Date(allPosts[i].createdAt*1000);
                        notesHtml.innerHTML += `<tr id="sl${i}" onclick="showNote(${i});">
                            <td>${i+1}</td>
                        <td>${allPosts[i].title}</td>
                        <td>${date}</td>
                        </tr>`;
                    }
                }

            }

    </script>
</body>
</html>